<!DOCTYPE html>
<html lang="so">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tufaax Smart Menu v4 - Refactored</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --tufaax-red: #ff4d4d; --dark-blue: #2b2d42; }
        body { background: #fdfdfd; font-family: 'Inter', sans-serif; padding-top: 80px; }
        
        /* Nav & Categories */
        .top-nav { position: fixed; top: 0; left: 0; right: 0; background: white; z-index: 2000; box-shadow: 0 2px 15px rgba(0,0,0,0.05); padding: 10px 0; }
        .nav-scroller { display: flex; overflow-x: auto; padding: 5px 15px; gap: 15px; scrollbar-width: none; justify-content: center; }
        .cat-item { text-align: center; text-decoration: none; color: #666; min-width: 75px; font-size: 0.85rem; }
        .cat-item i { font-size: 1.4rem; display: block; margin-bottom: 4px; color: #999; }
        .cat-item.active { color: var(--tufaax-red); font-weight: bold; }
        .cat-item.active i { color: var(--tufaax-red); }

        /* Food Cards */
        .section-title { font-weight: 800; font-size: 1.3rem; margin: 30px 0 15px; color: var(--dark-blue); text-transform: uppercase; letter-spacing: 1px; }
        .food-card { background: white; border-radius: 18px; border: 1px solid #f1f1f1; margin-bottom: 12px; display: flex; align-items: center; padding: 12px; transition: 0.2s; }
        .food-img { width: 80px; height: 80px; border-radius: 14px; object-fit: cover; margin-right: 15px; }
        .item-info { flex-grow: 1; }
        .item-name { font-size: 0.95rem; font-weight: 700; color: #333; }
        .item-price { color: var(--tufaax-red); font-weight: 800; }

        /* Quantity Controls */
        .qty-controls { display: flex; align-items: center; gap: 8px; background: #f8f9fa; border-radius: 10px; padding: 4px; }
        .qty-btn { border: none; background: white; width: 30px; height: 30px; border-radius: 8px; color: var(--dark-blue); font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .qty-val { font-weight: 800; min-width: 20px; text-align: center; }

        /* Footer */
        .checkout-footer { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px 20px 25px; border-radius: 25px 25px 0 0; box-shadow: 0 -10px 30px rgba(0,0,0,0.05); z-index: 3000; }
        .btn-checkout { background: var(--tufaax-red); color: white; border: none; padding: 16px; border-radius: 16px; width: 100%; font-weight: 800; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

    <nav class="top-nav">
        <div class="nav-scroller">
            <a href="#quraac" class="cat-item active"><i class="fas fa-coffee"></i>Quraac</a>
            <a href="#qado" class="cat-item"><i class="fas fa-utensils"></i>Qado</a>
            <a href="#casho" class="cat-item"><i class="fas fa-pizza-slice"></i>Casho</a>
            <a href="#cabitaan" class="cat-item"><i class="fas fa-glass-martini-alt"></i>Cabitaan</a>
        </div>
    </nav>

    <div class="container mb-5 pb-5">
        <div id="menu-content"></div>
    </div>

    <div class="checkout-footer">
        <button class="btn-checkout" onclick="handleOrder()">
            <span><i class="fab fa-whatsapp me-2"></i>DALBO HADDA</span>
            <span id="total-val">$0.00</span>
        </button>
    </div>

    <script>
        const menu = {
            quraac: [
                { name: "Canjeero & Beer", price: 3.5, img: "https://images.unsplash.com/photo-1593584785033-9c7604d0863f?w=200" },
                { name: "Muufo & Suugo", price: 2.5, img: "https://images.unsplash.com/photo-1541518763669-279f00ed0144?w=200" },
                { name: "Oodkac & Canjeero", price: 4.5, img: "https://images.unsplash.com/photo-1606787366850-de6330128bfc?w=200" },
                { name: "Mushaari", price: 1.5, img: "https://images.unsplash.com/photo-1517673400267-0251440c45dc?w=200" },
                { name: "Beer & Rooti", price: 3.0, img: "https://images.unsplash.com/photo-1533089860892-a7c6f0a88666?w=200" }
            ],
            qado: [
                { name: "Bariis & Hilib Ari", price: 5.0, img: "https://images.unsplash.com/photo-1512058560366-cd242d45869d?w=200" },
                { name: "Baasto Suugo Geel", price: 4.5, img: "https://images.unsplash.com/photo-1541544741938-0af808871cc0?w=200" },
                { name: "Bariis & Kalluun", price: 6.0, img: "https://images.unsplash.com/photo-1519708227418-c8fd9a32b7a2?w=200" }
            ],
            casho: [
                { name: "Pizza Tufaax", price: 8.0, img: "https://images.unsplash.com/photo-1513104890138-7c749659a591?w=200" },
                { name: "Burger Combo", price: 5.5, img: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=200" },
                { name: "Shawarma", price: 4.0, img: "https://images.unsplash.com/photo-1529006557810-274b9b2fc783?w=200" }
            ],
            cabitaan: [
                { name: "Fresh Tufaax", price: 1.5, img: "https://images.unsplash.com/photo-1567306226416-28f0efdc88ce?w=200" },
                { name: "Mango Juice", price: 1.5, img: "https://images.unsplash.com/photo-1546173159-315724a31696?w=200" },
                { name: "Avocado Special", price: 2.0, img: "https://images.unsplash.com/photo-1544903227-0b1a09ec60a2?w=200" }
            ]
        };

        let cart = {};

        // 1. Hagaajinta muuqaalka Menu-ga
        function renderMenu() {
            const container = document.getElementById('menu-content');
            let html = "";
            for (let category in menu) {
                html += `<h4 class="section-title" id="${category}">${category}</h4>`;
                menu[category].forEach(item => {
                    html += `
                        <div class="food-card">
                            <img src="${item.img}" class="food-img" alt="${item.name}">
                            <div class="item-info">
                                <div class="item-name">${item.name}</div>
                                <div class="item-price">$${item.price.toFixed(2)}</div>
                            </div>
                            <div class="qty-controls">
                                <button class="qty-btn" onclick="updateQty('${item.name}', ${item.price}, -1)">-</button>
                                <span class="qty-val" id="qty-${item.name}">0</span>
                                <button class="qty-btn" onclick="updateQty('${item.name}', ${item.price}, 1)">+</button>
                            </div>
                        </div>`;
                });
            }
            container.innerHTML = html;
        }

        // 2. Hagaajinta Calculation-ka (Kani waa line-kii aad codsatay)
        function updateQty(name, price, delta) {
            if (!cart[name]) cart[name] = { qty: 0, price: price };
            cart[name].qty = Math.max(0, cart[name].qty + delta);
            
            document.getElementById(`qty-${name}`).innerText = cart[name].qty;
            
            // Habka cusub ee xisaabinta:
            const total = Object.values(cart).reduce((sum, item) => sum + (item.qty * item.price), 0);
            document.getElementById('total-val').innerText = `$${total.toFixed(2)}`;
        }

        // 3. Maareynta Dalabka
        function handleOrder() {
            const total = document.getElementById('total-val').innerText;
            if (total === "$0.00") return alert("Fadlan dooq ka bixi menu-ga!");

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    pos => sendToWhatsApp(`https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`),
                    () => sendToWhatsApp("Location lama bixin")
                );
            } else {
                sendToWhatsApp("Browser-ku ma taageero Geolocation");
            }
        }

        function sendToWhatsApp(location) {
            let itemsText = "";
            for (let name in cart) {
                if (cart[name].qty > 0) itemsText += `‚úÖ ${cart[name].qty}x ${name}%0A`;
            }

            const total = document.getElementById('total-val').innerText;
            const message = `*DALAB CUSUB: TUFAAX RESTAURANT*%0A%0A${itemsText}%0A*WADARTA: ${total}*%0A%0Aüìç *Location-ka:*%0A${location}`;
            
            window.open(`https://wa.me/252617054480?text=${message}`, '_blank');
        }

        renderMenu();
    </script>
</body>
</html>
